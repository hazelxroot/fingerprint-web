{
  "version": 3,
  "file": "fingerprint-web.modern.js",
  "sources": [
    "../shared/constants.ts",
    "../shared/httpError.ts",
    "../shared/sanitizeFileName.ts",
    "../shared/is.ts",
    "../src/index.ts"
  ],
  "sourcesContent": [
    "export const TAG_AUDIO_SUPPORTED_EXT = [\n  '.mp3',\n  '.ogg',\n  '.spx',\n  '.mpc',\n  '.ape',\n  '.flac',\n  '.wv',\n  '.tta',\n  '.wma',\n  '.m4a',\n  '.m4b',\n  '.m4p',\n  '.mp4',\n  '.3g2',\n  '.wav',\n  '.aif',\n  '.aiff',\n  '.opus',\n];\n\nexport enum STATUS {\n  CREATED = 'CREATED',\n  UPLOADED = 'UPLOADED',\n  SUBMITTED = 'SUBMITTED',\n  ERROR = 'ERROR',\n  RESOLVED = 'RESOLVED',\n  NOT_FOUND = 'NOT_FOUND',\n  FOUND = 'FOUND',\n  DONE = 'DONE',\n  DELETED = 'DELETED',\n}\n\nexport enum ERROR {\n  UNKNOWN_ISRC = 'Unknown ISRC',\n  FAILED_TO_SUBMIT = 'Failed to submit',\n  FAILED_TO_PROCESS = 'Failed to process',\n}\n\nexport enum DOWNLOAD_OPTIONS {\n  URL = 'url',\n  REDIRECT = 'redirect',\n}\n",
    "export class HttpError extends Error {\n  statusCode: number;\n  constructor(message: string, statusCode: number) {\n    super(message);\n    this.statusCode = statusCode;\n    Object.setPrototypeOf(this, HttpError.prototype);\n  }\n}\n",
    "import { TAG_AUDIO_SUPPORTED_EXT } from './constants';\nimport { HttpError } from './httpError';\n\nexport function sanitizeFolderName(folderName: string) {\n  return (\n    folderName\n      /* Remove Line-Breaks */\n      .replace(/((\\r\\n)|\\r|\\n)+/gm, '')\n      /* Normalize Windows directory separators */\n      .replace(/\\\\/gm, '/')\n      /* Remove empty or ._- only dirs */\n      .replace(/(\\/|^)[\\._\\-\\/]+\\//g, '/')\n  );\n}\n\nexport default function sanitizeFileName(fileName: string) {\n  const ext = fileName.split('.').pop();\n\n  if (!ext) {\n    throw new HttpError(`${fileName} is missing an extension`, 400);\n  }\n\n  if (!TAG_AUDIO_SUPPORTED_EXT.includes(`.${ext.toLowerCase()}`)) {\n    throw new HttpError(`${ext} extension is not supported`, 415);\n  }\n\n  return `${sanitizeFolderName(\n    fileName.substring(0, fileName.length - (ext.length + 1)),\n  )}.${ext.toLowerCase()}`;\n}\n",
    "import type {\n  Created as CreatedInt,\n  Uploaded as UploadedInt,\n  Submitted as SubmittedInt,\n  Resolved as ResolvedInt,\n  NotFound as NotFoundInt,\n  Found as FoundInt,\n  Done as DoneInt,\n  Error as ErrorInt,\n  External,\n  SomeExternalAudio,\n} from './Audio';\nimport { STATUS } from './constants';\n\nexport type Created = External<CreatedInt>;\nexport type Uploaded = External<UploadedInt>;\nexport type Submitted = External<SubmittedInt>;\nexport type Resolved = External<ResolvedInt>;\nexport type NotFound = External<NotFoundInt>;\nexport type Found = External<FoundInt>;\nexport type Done = External<DoneInt>;\nexport type Error = External<ErrorInt>;\nexport type File = SomeExternalAudio;\n\nexport function isCreated(file: File): file is Created;\nexport function isCreated(\n  file: File,\n  exact: false,\n): file is Created | Uploaded | Submitted | NotFound | Resolved | Found | Done;\nexport function isCreated(file: File, exact: boolean = true): boolean {\n  return exact\n    ? file.status === STATUS.CREATED\n    : [\n        STATUS.CREATED,\n        STATUS.UPLOADED,\n        STATUS.SUBMITTED,\n        STATUS.NOT_FOUND,\n        STATUS.RESOLVED,\n        STATUS.FOUND,\n        STATUS.DONE,\n      ].includes(file.status);\n}\nexport function isUploaded(file: File): file is Uploaded;\nexport function isUploaded(\n  file: File,\n  exact: false,\n): file is Uploaded | Submitted | NotFound | Resolved | Found | Done;\nexport function isUploaded(file: File, exact: boolean = true): boolean {\n  return exact\n    ? file.status === STATUS.UPLOADED\n    : [\n        STATUS.UPLOADED,\n        STATUS.SUBMITTED,\n        STATUS.NOT_FOUND,\n        STATUS.RESOLVED,\n        STATUS.FOUND,\n        STATUS.DONE,\n      ].includes(file.status);\n}\nexport function isSubmitted(file: File): file is Submitted;\nexport function isSubmitted(\n  file: File,\n  exact: false,\n): file is Submitted | NotFound | Resolved | Found | Done;\nexport function isSubmitted(file: File, exact: boolean = true): boolean {\n  return exact\n    ? file.status === STATUS.SUBMITTED\n    : [\n        STATUS.SUBMITTED,\n        STATUS.NOT_FOUND,\n        STATUS.RESOLVED,\n        STATUS.FOUND,\n        STATUS.DONE,\n      ].includes(file.status);\n}\nexport function isResolved(file: File): file is Resolved;\nexport function isResolved(\n  file: File,\n  exact: false,\n): file is Resolved | Found | Done;\nexport function isResolved(file: File, exact: boolean = true): boolean {\n  return exact\n    ? file.status === STATUS.RESOLVED\n    : [STATUS.RESOLVED, STATUS.FOUND, STATUS.DONE].includes(file.status);\n}\nexport function isNotFound(file: File): file is NotFound {\n  return file.status === STATUS.NOT_FOUND;\n}\nexport function isFound(file: File): file is Found;\nexport function isFound(file: File, exact: false): file is Found | Done;\nexport function isFound(file: File, exact: boolean = true): boolean {\n  return exact\n    ? file.status === STATUS.FOUND\n    : [STATUS.FOUND, STATUS.DONE].includes(file.status);\n}\nexport function isDone(file: File): file is Done {\n  return file.status === STATUS.DONE;\n}\nexport function isError(file: File): file is Error {\n  return file.status === STATUS.ERROR;\n}\n",
    "import type { FolderList, File as SingleFile, FileList } from '../shared/Audio';\nimport sanitizeFileName, {\n  sanitizeFolderName,\n} from '../shared/sanitizeFileName';\nimport { DOWNLOAD_OPTIONS } from '../shared/constants';\n\ninterface Config {\n  token: string;\n  apiUrl: string;\n}\n\ntype UserConfig = Pick<Config, 'token'> & Partial<Omit<Config, 'token'>>;\n\nexport * from '../shared/is';\nexport { STATUS } from '../shared/constants';\nexport type { UserConfig as Config };\n\nexport default class MusicubeFingerprintingWeb {\n  config: Config;\n  constructor({\n    token,\n    apiUrl = 'https://w9dxkmzqu6.execute-api.eu-central-1.amazonaws.com',\n  }: UserConfig) {\n    this.config = { token, apiUrl };\n  }\n  async upload(\n    file: File & { overwrite?: boolean },\n    progress: (uploaded: number, total: number) => void = () => {},\n  ): Promise<string> {\n    const sanitizedName = sanitizeFileName(file.name);\n    const res = await fetch(\n      `${this.config.apiUrl.replace(/\\/$/, '')}/upload/${encodeURIComponent(\n        sanitizedName,\n      )}`,\n      {\n        headers: {\n          'x-mc-overwrite': file.overwrite ? 'yes' : 'no',\n          authorization: `Bearer ${this.config.token}`,\n        },\n      },\n    );\n\n    if (res.status !== 200) {\n      throw new Error(await res.text());\n    }\n\n    const { fields, url, name } = await res.json();\n    const form = new FormData();\n    const xhr = new XMLHttpRequest();\n\n    for (const key in fields) {\n      form.append(key, fields[key]);\n    }\n    form.append('file', file);\n\n    return new Promise<string>((res, rej) => {\n      xhr.onload = () => {\n        if (xhr.status === 204) {\n          res(name);\n        } else {\n          rej(new Error('Upload Failed'));\n        }\n      };\n      xhr.onerror = rej;\n      xhr.upload.addEventListener(\n        'progress',\n        (evt) => {\n          progress(evt.loaded, evt.total);\n        },\n        false,\n      );\n\n      xhr.open('POST', url, true);\n      xhr.send(form);\n    });\n  }\n  async folders() {\n    const res = await fetch(`${this.config.apiUrl.replace(/\\/$/, '')}/audio/`, {\n      headers: {\n        authorization: `Bearer ${this.config.token}`,\n      },\n    });\n\n    if (res.status !== 200) {\n      throw new Error(await res.text());\n    }\n\n    return ((await res.json()) as FolderList).folders;\n  }\n  async files(folder: string) {\n    if (sanitizeFolderName(folder) !== folder) {\n      throw new Error(`Invalid folder name: ${folder}`);\n    }\n\n    const res = await fetch(\n      `${this.config.apiUrl.replace(/\\/$/, '')}/audio/${encodeURIComponent(\n        folder,\n      )}/`,\n      {\n        headers: {\n          authorization: `Bearer ${this.config.token}`,\n        },\n      },\n    );\n\n    if (res.status !== 200) {\n      throw new Error(await res.text());\n    }\n\n    return ((await res.json()) as FileList).files;\n  }\n  async file(file: string) {\n    if (\n      sanitizeFileName(file) !== file ||\n      file.split('/').filter((t) => t && t.length).length !== 2\n    ) {\n      throw new Error(`Invalid file name: ${file}`);\n    }\n\n    const res = await fetch(\n      `${this.config.apiUrl.replace(/\\/$/, '')}/audio/${encodeURIComponent(\n        file,\n      )}`,\n      {\n        headers: {\n          authorization: `Bearer ${this.config.token}`,\n        },\n      },\n    );\n\n    if (res.status !== 200) {\n      throw new Error(await res.text());\n    }\n\n    return ((await res.json()) as SingleFile).file;\n  }\n  async delete(file: string) {\n    if (\n      sanitizeFileName(file) !== file ||\n      file.split('/').filter((t) => t && t.length).length !== 2\n    ) {\n      throw new Error(`Invalid file name: ${file}`);\n    }\n\n    const res = await fetch(\n      `${this.config.apiUrl.replace(/\\/$/, '')}/audio/${encodeURIComponent(\n        file,\n      )}`,\n      {\n        method: 'DELETE',\n        headers: {\n          authorization: `Bearer ${this.config.token}`,\n        },\n      },\n    );\n\n    if (res.status !== 204) {\n      throw new Error(await res.text());\n    }\n\n    return;\n  }\n  async resubmit(file: string) {\n    if (\n      sanitizeFileName(file) !== file ||\n      file.split('/').filter((t) => t && t.length).length !== 2\n    ) {\n      throw new Error(`Invalid file name: ${file}`);\n    }\n\n    const res = await fetch(\n      `${this.config.apiUrl.replace(/\\/$/, '')}/audio/${encodeURIComponent(\n        file,\n      )}`,\n      {\n        method: 'POST',\n        headers: {\n          'x-mc-resubmit': 'yes',\n          authorization: `Bearer ${this.config.token}`,\n        },\n      },\n    );\n\n    if (res.status !== 204) {\n      throw new Error(await res.text());\n    }\n\n    return;\n  }\n  async downloadLink(file: string) {\n    if (\n      sanitizeFileName(file) !== file ||\n      file.split('/').filter((t) => t && t.length).length !== 2\n    ) {\n      throw new Error(`Invalid file name: ${file}`);\n    }\n\n    const res = await fetch(\n      `${this.config.apiUrl.replace(/\\/$/, '')}/audio/${encodeURIComponent(\n        file,\n      )}`,\n      {\n        headers: {\n          'x-mc-download': DOWNLOAD_OPTIONS.URL,\n          authorization: `Bearer ${this.config.token}`,\n        },\n      },\n    );\n\n    if (res.status !== 200) {\n      throw new Error(await res.text());\n    }\n\n    return res.text();\n  }\n}\n"
  ],
  "names": [
    "TAG_AUDIO_SUPPORTED_EXT",
    "STATUS",
    "ERROR",
    "DOWNLOAD_OPTIONS",
    "HttpError",
    "Error",
    "constructor",
    "message",
    "statusCode",
    "super",
    "this",
    "Object",
    "setPrototypeOf",
    "prototype",
    "sanitizeFolderName",
    "folderName",
    "replace",
    "sanitizeFileName",
    "fileName",
    "ext",
    "split",
    "pop",
    "includes",
    "toLowerCase",
    "substring",
    "length",
    "isCreated",
    "file",
    "exact",
    "status",
    "CREATED",
    "UPLOADED",
    "SUBMITTED",
    "NOT_FOUND",
    "RESOLVED",
    "FOUND",
    "DONE",
    "isUploaded",
    "isSubmitted",
    "isResolved",
    "isNotFound",
    "isFound",
    "isDone",
    "isError",
    "MusicubeFingerprintingWeb",
    "token",
    "apiUrl",
    "config",
    "upload",
    "progress",
    "sanitizedName",
    "name",
    "res",
    "fetch",
    "encodeURIComponent",
    "headers",
    "overwrite",
    "authorization",
    "text",
    "fields",
    "url",
    "json",
    "form",
    "FormData",
    "xhr",
    "XMLHttpRequest",
    "key",
    "append",
    "Promise",
    "rej",
    "onload",
    "onerror",
    "addEventListener",
    "evt",
    "loaded",
    "total",
    "open",
    "send",
    "folders",
    "files",
    "folder",
    "filter",
    "t",
    "delete",
    "method",
    "resubmit",
    "downloadLink",
    "URL"
  ],
  "mappings": "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"
}
